#!/usr/bin/env ruby

require 'rubygems'
require 'commander/import'
require 'mobilywscli'

program :version, '0.0.1'
program :description, 'CLI FOR MOBILY SMS'
default_command :welcome

command :welcome do |c|
  c.syntax = 'status'
  c.description = 'Displays welcome message'
  c.action do |args, options|
    print_header
    print_footer
  end
end

command :setup do |c|
  c.syntax = 'type setup and press enter key and follow the prompt'
  c.description = 'Add mobilyws login information >> username - password - sender   <<  '
  c.action do |args, options|
    
    print_header
    
    #username = ask("USERNAME: ")
    #password = ask("PASSWORD: ")
    #sender = ask("SENDER: ")
    
     #Mobilywscli::Settings.mobily_username= ask("USERNAME: ")
     #Mobilywscli::Settings.mobily_password= ask("PASSWORD: ")
     #Mobilywscli::Settings.mobily_sender= ask("SENDER: ")
          
     #yml_content = YAML.load_file("/settings.yml")
     
     
     say Mobilywscli.setup( ask("USERNAME: "), ask("PASSWORD: "),  ask("SENDER: "))
     
     #yml_content['language'] = "ARABIC"
     
     #puts yml_content['mobily_username']
     
     #File.open("../settings.yml", 'w') { |f| YAML.dump(yml_content, f) }
     
     #File.open('settings.yml','w') do |h| 
        #h.write yml_content.to_yaml
     #end
     
    #configatron.mobily_username = ask("USERNAME: ")
    #configatron.mobily_password = ask("PASSWORD: ")
    #configatron.mobily_sender = ask("SENDER: ")
    
    
    #say "#{Mobilywscli::Settings.mobily_username} ||||||||   #{Mobilywscli::Settings.mobily_password}     ||||||||||||    #{Mobilywscli::Settings.mobily_sender}"
    
    
    #say "Done!"
    print_footer
  end
end

command :status do |c|
  c.syntax = 'status'
  c.description = 'Displays mobilyws gateway status'
  c.action do |args, options|
    print_header
    say Mobilywscli.send_status
    print_footer
  end
end

command :balance do |c|
  c.syntax = 'balance'
  c.description = 'Displays current balance'
  c.action do |args, options|
    print_header
    say Mobilywscli.get_balance
    print_footer
  end
end

command :sendsms do |c|
  c.syntax = 'type sendsms and press enter key and follow the prompt'
  c.description = 'Send a new sms message'
  c.action do |args, options|
    print_header
    numbers = ask("Numbers: ")
    message = ask("Message: ")
    say Mobilywscli.send(numbers,message)
    print_footer
  end
end

def print_header
  puts "\n\n\n||||||||||||||||||    Welcome to Mobily SMS Gateway!    ||||||||||||||||||\n\n\n"
end

def print_footer
  puts "\n\n\n"
end


__END__
    system "export MOBILYWS_USERNAME=#{username}"
    system "export MOBILYWS_PASSWORD=#{password}"
    system "export MOBILYWS_SENDER=#{sender}"